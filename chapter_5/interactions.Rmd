---
title: "Interactions by treatment"
author: "Andrew Heiss"
date: "November 16, 2015"
output: 
  html_document: 
    css: fixes.css
    highlight: pygments
    number_sections: yes
    theme: flatly
    toc: yes
    includes:
      in_header: scripts.html
---

```{r setup, include=FALSE}
source("clean_data.R")
knitr::opts_chunk$set(echo = TRUE)
library(broom)
library(ggplot2)
library(scales)
library(stargazer)
library(pander)

parens <- function(model, variable, statistic) {
  df <- model %>% tidy() %>%
    filter(term == variable) %>%
    select(statistic, p.value)
  
  if (df$p.value > 0.001) {
    out <- sprintf("%s = %.2f, p = %.3f", statistic, df$statistic, df$p.value)
  } else {
    out <- sprintf("%s = %.2f, p < 0.001", statistic, df$statistic)
  }
  
  return(out)
}

# Multiplier for standard error areas
std <- qnorm(0.95 / 2 + 0.5)

report.colors <- c("#E97F01", "#014358")
rating.colors <- c("#490A3D", "#EA2E49")
demote.colors <- c("#00A0B0", "#6A4A3C", "#CC333F")

df.correct <- df.correct %>%
  mutate(in.report = ifelse(tier1 == 0, "Not in report", "In report"),
         in.report = factor(in.report, levels=c("Not in report", "In report"),
                            ordered=TRUE),
         lower.rating = ifelse(tier1 %in% c(1, 2), "1 or 2", "Watchlist or 3"),
         lower.rating = factor(lower.rating, levels=c("1 or 2", "Watchlist or 3"), 
                               ordered=TRUE))

df.logit.models <- df.correct %>% 
  filter(lag(adjbicrimlevel) == 0 & year > 2001 & year < 2011)

# Calculate a pseudo R-squared measure using
# 1-\frac{\text{Residual Deviance}}{\text{Null Deviance}}
calc.pseudo.r.squared <- function(x.model) {
  return(round(1 - (x.model$deviance / x.model$null.deviance), 4))
}

clean.labs <- function(x) {
  # Divide into comma-separated parts
  separated <- unlist(strsplit(x, ","))
  
  # Remove anything that's not a digit from each part
  cleaned <- sapply(separated, FUN=function (y) 
    as.numeric(gsub("\\[|\\]|\\(|\\)", "", y)))
  
  # Concatenate remaining digits
  return(paste(cleaned, collapse="-"))
}
```


# Monitoring (presence in the TIP report)

## Democracy × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.democracy.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(in.report, fh_cl1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  filter(crim.yes > 0)

p.dem.prob.report <- ggplot(prob.crim.democracy.report, 
       aes(x=fh_cl1, y=prob.yes, colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.dem.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.dem.simple.report <- glm(crim1 ~ fh_cl1 + inreport1 + women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.dem.int.report <- glm(crim1 ~ fh_cl1 + inreport1 + fh_cl1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.dem.simple.report, model.dem.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.dem.simple.report, model.dem.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.dem.int.report

new.data <- model$model %>%
  select(-fh_cl1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(fh_cl1 = seq(1, 7, 0.1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.dem.int.report <- ggplot(plot.predict, aes(x=fh_cl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b", position="jitter") + 
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.dem.int.report
```

---

## NGO engagement × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_ave.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ngos_ave, seq(0, 10, 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_ave.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_ave.report, by=c("in.report", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos.prob.report <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="NGO engagement", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.simple.report <- glm(crim1 ~ ngos_ave + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.int.report <- glm(crim1 ~ ngos_ave + fh_cl1 + inreport1 + 
                         ngos_ave * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("NGO engagement",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "NGO engagement × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.simple.report, model.ngo.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.simple.report, model.ngo.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.int.report

new.data <- model$model %>%
  select(-ngos_ave) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ngos_ave = seq(0, 10, 0.1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.ngo.int.report <- ggplot(plot.predict, aes(x=ngos_ave, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="NGO engagement", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.ngo.int.report
```

---

## Media coverage × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.media.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(news_bin = cut(ht_news_country1, c(seq(0, 500, 50), 2500), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, news_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.media.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), news_bin = levels(.$news_bin))) %>%
  left_join(prob.crim.media.report, by=c("in.report", "news_bin")) %>%
  mutate(news_bin = factor(news_bin, 
                           labels=sapply(levels(news_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.media.prob.report <- ggplot(full, aes(x=news_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Media coverage", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.media.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.media.super.basic <- glm(crim1 ~ ht_news_country1 + inreport1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.basic <- glm(crim1 ~ ht_news_country1 + inreport1 + 
                          ht_news_country1 * inreport1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.simple.report <- glm(crim1 ~ ht_news_country1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.int.report <- glm(crim1 ~ ht_news_country1 + fh_cl1 + inreport1 + 
                         ht_news_country1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))
# bloop <- df.logit.models %>% select(name, year, cowcode, crim1, ht_news_country1, inreport1) %>% mutate(ht_news_country1 * inreport1)
# write_csv(bloop, path="~/Desktop/sample_data.csv", na="")

var.labs <- c("Media coverage",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Media coverage × In TIP report")

extra.lines <- list(c("Year fixed effects", c("Yes", "No", "No", "Yes")),
                    c("Pseudo R-squared",
                      sapply(list(model.media.simple.report, model.media.super.basic,
                                  model.media.basic, model.media.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.media.simple.report, model.media.super.basic, model.media.basic, model.media.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.media.int.report

new.data <- model$model %>%
  select(-ht_news_country1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_news_country1 = seq(0, 1000, 1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.media.int.report <- ggplot(plot.predict, aes(x=ht_news_country1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Media coverage", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.media.int.report
```

---

## US foreign aid × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.aid.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(aid_bin = cut(logeconasstP_1, seq(0, 25, 5), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, aid_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.aid.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), aid_bin = levels(.$aid_bin))) %>%
  left_join(prob.crim.aid.report, by=c("in.report", "aid_bin")) %>%
  mutate(aid_bin = factor(aid_bin, 
                           labels=sapply(levels(aid_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.aid.prob.report <- ggplot(full, aes(x=aid_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="US aid (logged)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.aid.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.aid.simple.report <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.aid.int.report <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + inreport1 + 
                         logeconasstP_1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("US aid (logged)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US aid × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.aid.simple.report, model.aid.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.aid.simple.report, model.aid.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.aid.int.report

new.data <- model$model %>%
  select(-logeconasstP_1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(logeconasstP_1 = seq(0, 23, 0.1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.aid.int.report <- ggplot(plot.predict, aes(x=logeconasstP_1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="US foreign aid (logged)", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.aid.int.report
```

---

## US trade × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.trade.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(trade_bin = cut(newus_tradeshare_gdp, seq(0, 1, 0.1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, trade_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.trade.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), trade_bin = levels(.$trade_bin))) %>%
  left_join(prob.crim.trade.report, by=c("in.report", "trade_bin")) %>%
  mutate(trade_bin = factor(trade_bin, 
                           labels=sapply(levels(trade_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.trade.prob.report <- ggplot(full, aes(x=trade_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Share of US trade (% of GDP)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.trade.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.trade.simple.report <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.trade.int.report <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + inreport1 + 
                         newus_tradeshare_gdp * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Share of US trade (% of GDP)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Trade share × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.trade.simple.report, model.trade.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.trade.simple.report, model.trade.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.trade.int.report

new.data <- model$model %>%
  select(-newus_tradeshare_gdp) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(newus_tradeshare_gdp = seq(0, 0.6, 0.05), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.trade.int.report <- ggplot(plot.predict, aes(x=newus_tradeshare_gdp, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Trade with US (percent of GDP)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.trade.int.report
```

---

## Protocol ratified × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.rat.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(in.report, ratproto2000_1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  mutate(ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

p.rat.prob.report <- ggplot(prob.crim.rat.report, aes(x=ratproto2000_1, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="2000 TIP protocol ratification", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.rat.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.rat.simple.report <- glm(crim1 ~ fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.rat.int.report <- glm(crim1 ~ fh_cl1 + inreport1 + 
                         ratproto2000_1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Protocol ratification × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.rat.simple.report, model.rat.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.rat.simple.report, model.rat.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.rat.int.report

new.data <- model$model %>%
  select(-ratproto2000_1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ratproto2000_1 = c(0, 1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE),
         ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.rat.int.report <- ggplot(plot.predict, aes(x=ratproto2000_1, y=prob, colour=inreport1)) + 
  geom_pointrange(aes(ymax=prob.upper, ymin=prob.lower), size=.75,
                  position=position_dodge(width=0.25)) + 
  labs(x="2000 TIP protocol ratification", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.rat.int.report
```

---

## Wikileaks engagement/intensity × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.wl.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(wl_bin = cut(prop_tip_wl1, c(seq(0, 0.2, 0.05), 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, wl_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.wl.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), wl_bin = levels(.$wl_bin))) %>%
  left_join(prob.crim.wl.report, by=c("in.report", "wl_bin")) %>%
  mutate(wl_bin = factor(wl_bin, 
                           labels=sapply(levels(wl_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.wl.prob.report <- ggplot(full, aes(x=wl_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.wl.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.wl.simple.report <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.wl.int.report <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + inreport1 + 
                         prop_tip_wl1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Proportion of TIP-related cables (observed in Wikileaks)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "TIP cables × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.wl.simple.report, model.wl.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.wl.simple.report, model.wl.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.wl.int.report

new.data <- model$model %>%
  select(-prop_tip_wl1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(prop_tip_wl1 = seq(0, 1, 0.05), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.wl.int.report <- ggplot(plot.predict, aes(x=prop_tip_wl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.wl.int.report
```

---

## TIP NGO count × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_new.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ht_ngos, c(seq(0, 20, 5), 100), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_new.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_new.report, by=c("in.report", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos_new.prob.report <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Number of anti-TIP NGOs", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos_new.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.new.simple.report <- glm(crim1 ~ ht_ngos + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.new.int.report <- glm(crim1 ~ ht_ngos + fh_cl1 + inreport1 + 
                         ht_ngos * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Number of anti-TIP NGOs",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Anti-TIP NGOs × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.new.simple.report, model.ngo.new.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.new.simple.report, model.ngo.new.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.new.int.report

new.data <- model$model %>%
  select(-ht_ngos) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_ngos = seq(0, 100, 0.5), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.ngo.new.int.report <- ggplot(plot.predict, aes(x=ht_ngos, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Number of anti-TIP NGOs", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.ngo.new.int.report
```

---

## TIP funding from US × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.funding.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(funding_bin = cut(log.total.funding1, c(0, seq(10, 20, 2.5)), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, funding_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.funding.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), funding_bin = levels(.$funding_bin))) %>%
  left_join(prob.crim.funding.report, by=c("in.report", "funding_bin")) %>%
  mutate(funding_bin = factor(funding_bin, 
                           labels=sapply(levels(funding_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.funding.prob.report <- ggplot(full, aes(x=funding_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Total anti-TIP funding from US (log)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.funding.prob.report
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.funding.simple.report <- glm(crim1 ~ log.total.funding1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.funding.int.report <- glm(crim1 ~ log.total.funding1 + fh_cl1 + inreport1 + 
                         log.total.funding1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Total anti-TIP funding from US (log)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US funding × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.funding.simple.report, model.funding.int.report), 
                             calc.pseudo.r.squared)))

stargazer(model.funding.simple.report, model.funding.int.report,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.funding.int.report

new.data <- model$model %>%
  select(-log.total.funding1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(log.total.funding1 = seq(0, 16, 0.5), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.funding.int.report <- ggplot(plot.predict, aes(x=log.total.funding1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Total anti-TIP funding from US (log)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.funding.int.report
```

---

# Lower tier ratings

## Democracy × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.democracy.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(lower.rating, fh_cl1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  filter(crim.yes > 0)

p.dem.prob.rating <- ggplot(prob.crim.democracy.rating, 
       aes(x=fh_cl1, y=prob.yes, colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.dem.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.dem.simple.rating <- glm(crim1 ~ fh_cl1 + low_tier1 + women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.dem.int.rating <- glm(crim1 ~ fh_cl1 + low_tier1 + fh_cl1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.dem.simple.rating, model.dem.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.dem.simple.rating, model.dem.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.dem.int.rating

new.data <- model$model %>%
  select(-fh_cl1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(fh_cl1 = seq(1, 7, 0.1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.dem.int.rating <- ggplot(plot.predict, aes(x=fh_cl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b", position="jitter") + 
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.dem.int.rating
```

---

## NGO engagement × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_ave.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ngos_ave, seq(0, 10, 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_ave.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_ave.rating, by=c("lower.rating", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos.prob.rating <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                colour=lower.rating, size=crim.yes)) + 
  geom_point(position=position_dodge(width=0.3)) +
  labs(x="NGO engagement", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.simple.rating <- glm(crim1 ~ ngos_ave + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.int.rating <- glm(crim1 ~ ngos_ave + fh_cl1 + low_tier1 + 
                         ngos_ave * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("NGO engagement",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "NGO engagement × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.simple.rating, model.ngo.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.simple.rating, model.ngo.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.int.rating

new.data <- model$model %>%
  select(-ngos_ave) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ngos_ave = seq(0, 10, 0.1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.ngo.int.rating <- ggplot(plot.predict, aes(x=ngos_ave, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="NGO engagement", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.ngo.int.rating
```

---

## Media coverage × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.media.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(news_bin = cut(ht_news_country1, c(seq(0, 500, 50), 2500), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, news_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.media.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), news_bin = levels(.$news_bin))) %>%
  left_join(prob.crim.media.rating, by=c("lower.rating", "news_bin")) %>%
  mutate(news_bin = factor(news_bin, 
                           labels=sapply(levels(news_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.media.prob.rating <- ggplot(full, aes(x=news_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Media coverage", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.media.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.media.simple.rating <- glm(crim1 ~ ht_news_country1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.int.rating <- glm(crim1 ~ ht_news_country1 + fh_cl1 + low_tier1 + 
                         ht_news_country1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Media coverage",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Media coverage × Lowest tier")

extra.lines <- list(c("Year fixed effects", c("Yes", "Yes")),
                    c("Pseudo R-squared",
                      sapply(list(model.media.simple.rating, model.media.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.media.simple.rating,  model.media.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.media.int.rating

new.data <- model$model %>%
  select(-ht_news_country1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_news_country1 = seq(0, 1000, 1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.media.int.rating <- ggplot(plot.predict, aes(x=ht_news_country1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Media coverage", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.media.int.rating
```

---

## US foreign aid × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.aid.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(aid_bin = cut(logeconasstP_1, seq(0, 25, 5), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, aid_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.aid.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), aid_bin = levels(.$aid_bin))) %>%
  left_join(prob.crim.aid.rating, by=c("lower.rating", "aid_bin")) %>%
  mutate(aid_bin = factor(aid_bin, 
                           labels=sapply(levels(aid_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.aid.prob.rating <- ggplot(full, aes(x=aid_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="US aid (logged)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.aid.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.aid.simple.rating <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.aid.int.rating <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + low_tier1 + 
                         logeconasstP_1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("US aid (logged)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US aid × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.aid.simple.rating, model.aid.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.aid.simple.rating, model.aid.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.aid.int.rating

new.data <- model$model %>%
  select(-logeconasstP_1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(logeconasstP_1 = seq(0, 23, 0.1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.aid.int.rating <- ggplot(plot.predict, aes(x=logeconasstP_1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="US foreign aid (logged)", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.aid.int.rating
```

---

## US trade × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.trade.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(trade_bin = cut(newus_tradeshare_gdp, seq(0, 1, 0.1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, trade_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.trade.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), trade_bin = levels(.$trade_bin))) %>%
  left_join(prob.crim.trade.rating, by=c("lower.rating", "trade_bin")) %>%
  mutate(trade_bin = factor(trade_bin, 
                           labels=sapply(levels(trade_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.trade.prob.rating <- ggplot(full, aes(x=trade_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Share of US trade (% of GDP)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.trade.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.trade.simple.rating <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.trade.int.rating <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + low_tier1 + 
                         newus_tradeshare_gdp * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Share of US trade (part of GDP)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Trade share × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.trade.simple.rating, model.trade.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.trade.simple.rating, model.trade.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.trade.int.rating

new.data <- model$model %>%
  select(-newus_tradeshare_gdp) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(newus_tradeshare_gdp = seq(0, 0.6, 0.05), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.trade.int.rating <- ggplot(plot.predict, aes(x=newus_tradeshare_gdp, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Trade with US (percent of GDP)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.trade.int.rating
```

---

## Protocol ratified × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.rat.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(lower.rating, ratproto2000_1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  mutate(ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

p.rat.prob.rating <- ggplot(prob.crim.rat.rating, aes(x=ratproto2000_1, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="2000 TIP protocol ratification", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.rat.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.rat.simple.rating <- glm(crim1 ~ fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.rat.int.rating <- glm(crim1 ~ fh_cl1 + low_tier1 + 
                         ratproto2000_1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Protocol ratification × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.rat.simple.rating, model.rat.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.rat.simple.rating, model.rat.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.rat.int.rating

new.data <- model$model %>%
  select(-ratproto2000_1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ratproto2000_1 = c(0, 1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE),
         ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.rat.int.rating <- ggplot(plot.predict, aes(x=ratproto2000_1, y=prob, colour=low_tier1)) + 
  geom_pointrange(aes(ymax=prob.upper, ymin=prob.lower), size=.75,
                  position=position_dodge(width=0.25)) + 
  labs(x="2000 TIP protocol ratification", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.rat.int.rating
```

---

## Wikileaks engagement/intensity × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.wl.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(wl_bin = cut(prop_tip_wl1, c(seq(0, 0.2, 0.05), 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, wl_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.wl.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), wl_bin = levels(.$wl_bin))) %>%
  left_join(prob.crim.wl.rating, by=c("lower.rating", "wl_bin")) %>%
  mutate(wl_bin = factor(wl_bin, 
                           labels=sapply(levels(wl_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.wl.prob.rating <- ggplot(full, aes(x=wl_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.wl.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.wl.simple.rating <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.wl.int.rating <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + low_tier1 + 
                         prop_tip_wl1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Proportion of TIP-related cables (observed in Wikileaks)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "TIP cables × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.wl.simple.rating, model.wl.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.wl.simple.rating, model.wl.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.wl.int.rating

new.data <- model$model %>%
  select(-prop_tip_wl1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(prop_tip_wl1 = seq(0, 1, 0.05), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.wl.int.rating <- ggplot(plot.predict, aes(x=prop_tip_wl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.wl.int.rating
```

---

## TIP NGO count × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_new.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ht_ngos, c(seq(0, 20, 5), 100), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_new.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_new.rating, by=c("lower.rating", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos_new.prob.rating <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Number of anti-TIP NGOs", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos_new.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.new.simple.rating <- glm(crim1 ~ ht_ngos + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.new.int.rating <- glm(crim1 ~ ht_ngos + fh_cl1 + low_tier1 + 
                         ht_ngos * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Number of anti-TIP NGOs",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Anti-TIP NGOs × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.new.simple.rating, model.ngo.new.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.new.simple.rating, model.ngo.new.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.new.int.rating

new.data <- model$model %>%
  select(-ht_ngos) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_ngos = seq(0, 100, 0.5), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.ngo.new.int.rating <- ggplot(plot.predict, aes(x=ht_ngos, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Number of anti-TIP NGOs", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.ngo.new.int.rating
```

---

## TIP funding from US × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.funding.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(funding_bin = cut(log.total.funding1, c(0, seq(10, 20, 2.5)), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, funding_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.funding.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), funding_bin = levels(.$funding_bin))) %>%
  left_join(prob.crim.funding.rating, by=c("lower.rating", "funding_bin")) %>%
  mutate(funding_bin = factor(funding_bin, 
                           labels=sapply(levels(funding_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.funding.prob.rating <- ggplot(full, aes(x=funding_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Total anti-TIP funding from US (log)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.funding.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.funding.simple.rating <- glm(crim1 ~ log.total.funding1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.funding.int.rating <- glm(crim1 ~ log.total.funding1 + fh_cl1 + low_tier1 + 
                         log.total.funding1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Total anti-TIP funding from US (log)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US funding × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.funding.simple.rating, model.funding.int.rating), 
                             calc.pseudo.r.squared)))

stargazer(model.funding.simple.rating, model.funding.int.rating,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.funding.int.rating

new.data <- model$model %>%
  select(-log.total.funding1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(log.total.funding1 = seq(0, 16, 0.5), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.funding.int.rating <- ggplot(plot.predict, aes(x=log.total.funding1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Total anti-TIP funding from US (log)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.funding.int.rating
```

---

# Downgrading

## Democracy × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.democracy.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  # Treatment
  group_by(demote_type, fh_cl1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  filter(crim.yes > 0)

p.dem.prob.demote <- ggplot(prob.crim.democracy.demote, 
       aes(x=fh_cl1, y=prob.yes, colour=demote_type, size=crim.yes)) + 
  geom_point() +
  # geom_line(size=1) + 
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.dem.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.dem.simple.demote <- glm(crim1 ~ fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                        women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.dem.int.demote <- glm(crim1 ~ fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     fh_cl1 * new_watch3 + 
                     fh_cl1 * new_watch2 + 
                     fh_cl1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.dem.simple.demote, model.dem.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.dem.simple.demote, model.dem.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.dem.int.demote

covars <- model$model %>%
  select(-fh_cl1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(fh_cl1 = seq(1, 7, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(fh_cl1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.dem.int.demote <- ggplot(plot.predict, aes(x=fh_cl1, y=prob)) + 
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b", position="jitter") +
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.dem.int.demote
```

---

## NGO engagement × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_ave.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(ngos_bin = cut(ngos_ave, seq(0, 10, 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_ave.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_ave.demote, by=c("demote_type", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos.prob.demote <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                colour=demote_type, size=crim.yes)) + 
  geom_point(position=position_dodge(width=0.3)) +
  labs(x="NGO engagement", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.simple.demote <- glm(crim1 ~ ngos_ave + fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.int.demote <- glm(crim1 ~ ngos_ave + fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     ngos_ave * new_watch3 + 
                     ngos_ave * new_watch2 + 
                     ngos_ave * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("NGO engagement",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.simple.demote, model.ngo.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.simple.demote, model.ngo.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.int.demote

covars <- model$model %>%
  select(-ngos_ave, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ngos_ave = seq(0, 10, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ngos_ave ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.ngo.int.demote <- ggplot(plot.predict, aes(x=ngos_ave, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="NGO engagement", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.ngo.int.demote
```

---

## Media coverage × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.media.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(news_bin = cut(ht_news_country1, c(seq(0, 500, 50), 2500), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, news_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.media.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), news_bin = levels(.$news_bin))) %>%
  left_join(prob.crim.media.demote, by=c("demote_type", "news_bin")) %>%
  mutate(news_bin = factor(news_bin, 
                           labels=sapply(levels(news_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.media.prob.demote <- ggplot(full, aes(x=news_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Media coverage", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.media.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.media.simple.demote <- glm(crim1 ~ ht_news_country1 + fh_cl1 + 
                          new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.int.demote <- glm(crim1 ~ ht_news_country1 + fh_cl1 + 
                       new_watch3 + new_watch2 + new_watch1 + 
                     ht_news_country1 * new_watch3 + 
                     ht_news_country1 * new_watch2 + 
                     ht_news_country1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Media coverage",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", c("Yes", "Yes")),
                    c("Pseudo R-squared",
                      sapply(list(model.media.simple.demote, model.media.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.media.simple.demote,  model.media.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.media.int.demote

covars <- model$model %>%
  select(-ht_news_country1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ht_news_country1 = seq(0, 1000, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ht_news_country1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.media.int.demote <- ggplot(plot.predict, aes(x=ht_news_country1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Media coverage", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.media.int.demote
```

---

## US foreign aid × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.aid.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(aid_bin = cut(logeconasstP_1, seq(0, 25, 5), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, aid_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.aid.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), aid_bin = levels(.$aid_bin))) %>%
  left_join(prob.crim.aid.demote, by=c("demote_type", "aid_bin")) %>%
  mutate(aid_bin = factor(aid_bin, 
                           labels=sapply(levels(aid_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.aid.prob.demote <- ggplot(full, aes(x=aid_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="US aid (logged)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.aid.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.aid.simple.demote <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.aid.int.demote <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     logeconasstP_1 * new_watch3 + 
                     logeconasstP_1 * new_watch2 + 
                     logeconasstP_1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("US aid (logged)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.aid.simple.demote, model.aid.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.aid.simple.demote, model.aid.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.aid.int.demote

covars <- model$model %>%
  select(-logeconasstP_1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(logeconasstP_1 = seq(0, 23, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(logeconasstP_1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.aid.int.demote <- ggplot(plot.predict, aes(x=logeconasstP_1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="US foreign aid (logged)", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.aid.int.demote
```

---

## US trade × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.trade.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(trade_bin = cut(newus_tradeshare_gdp, seq(0, 1, 0.1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, trade_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.trade.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), trade_bin = levels(.$trade_bin))) %>%
  left_join(prob.crim.trade.demote, by=c("demote_type", "trade_bin")) %>%
  mutate(trade_bin = factor(trade_bin, 
                           labels=sapply(levels(trade_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.trade.prob.demote <- ggplot(full, aes(x=trade_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Share of US trade (% of GDP)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.trade.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.trade.simple.demote <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 +
                          new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.trade.int.demote <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 +
                       new_watch3 + new_watch2 + new_watch1 + 
                     newus_tradeshare_gdp * new_watch3 + 
                     newus_tradeshare_gdp * new_watch2 + 
                     newus_tradeshare_gdp * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Share of US trade (part of GDP)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.trade.simple.demote, model.trade.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.trade.simple.demote, model.trade.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.trade.int.demote

covars <- model$model %>%
  select(-newus_tradeshare_gdp, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(newus_tradeshare_gdp = seq(0, 0.6, 0.05),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(newus_tradeshare_gdp ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.trade.int.demote <- ggplot(plot.predict, aes(x=newus_tradeshare_gdp, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Trade with US (percent of GDP)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.trade.int.demote
```

---

## Protocol ratified × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.rat.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  # Treatment
  group_by(demote_type, ratproto2000_1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  mutate(ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

p.rat.prob.demote <- ggplot(prob.crim.rat.demote, aes(x=ratproto2000_1, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="2000 TIP protocol ratification", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.rat.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.rat.simple.demote <- glm(crim1 ~ fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.rat.int.demote <- glm(crim1 ~ fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     ratproto2000_1 * new_watch3 + 
                     ratproto2000_1 * new_watch2 + 
                     ratproto2000_1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.rat.simple.demote, model.rat.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.rat.simple.demote, model.rat.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.rat.int.demote

covars <- model$model %>%
  select(-ratproto2000_1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ratproto2000_1 = c(0, 1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ratproto2000_1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")),
         ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.rat.int.demote <- ggplot(plot.predict, aes(x=ratproto2000_1, 
                                             y=prob, colour=demote_type)) + 
  geom_pointrange(aes(ymax=prob.upper, ymin=prob.lower), size=.75,
                  position=position_dodge(width=0.25)) + 
  labs(x="2000 TIP protocol ratification", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.rat.int.demote
```

---

## Wikileaks engagement/intensity × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.wl.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(wl_bin = cut(prop_tip_wl1, c(seq(0, 0.2, 0.05), 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, wl_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.wl.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), wl_bin = levels(.$wl_bin))) %>%
  left_join(prob.crim.wl.demote, by=c("demote_type", "wl_bin")) %>%
  mutate(wl_bin = factor(wl_bin, 
                           labels=sapply(levels(wl_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.wl.prob.demote <- ggplot(full, aes(x=wl_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.wl.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.wl.simple.demote <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + 
                       new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.wl.int.demote <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + 
                    new_watch3 + new_watch2 + new_watch1 + 
                     prop_tip_wl1 * new_watch3 + 
                     prop_tip_wl1 * new_watch2 + 
                     prop_tip_wl1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Proportion of TIP-related cables (observed in Wikileaks)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.wl.simple.demote, model.wl.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.wl.simple.demote, model.wl.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.wl.int.demote

covars <- model$model %>%
  select(-prop_tip_wl1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(prop_tip_wl1 = seq(0, 1, 0.05),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(prop_tip_wl1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.wl.int.demote <- ggplot(plot.predict, aes(x=prop_tip_wl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.wl.int.demote
```

---

## TIP NGO count × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_new.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(ngos_bin = cut(ht_ngos, c(seq(0, 20, 5), 100), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_new.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_new.demote, by=c("demote_type", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos_new.prob.demote <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Number of anti-TIP NGOs", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos_new.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.new.simple.demote <- glm(crim1 ~ ht_ngos + fh_cl1 + 
                            new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.new.int.demote <- glm(crim1 ~ ht_ngos + fh_cl1 + 
                         new_watch3 + new_watch2 + new_watch1 + 
                     ht_ngos * new_watch3 + 
                     ht_ngos * new_watch2 + 
                     ht_ngos * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Number of anti-TIP NGOs",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.new.simple.demote, model.ngo.new.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.new.simple.demote, model.ngo.new.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.new.int.demote

covars <- model$model %>%
  select(-ht_ngos, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ht_ngos = seq(0, 100, 0.5),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ht_ngos ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.ngo.new.int.demote <- ggplot(plot.predict, aes(x=ht_ngos, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Number of anti-TIP NGOs", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.ngo.new.int.demote
```

---

## TIP funding from US × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.funding.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(funding_bin = cut(log.total.funding1, c(0, seq(10, 20, 2.5)), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, funding_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.funding.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), funding_bin = levels(.$funding_bin))) %>%
  left_join(prob.crim.funding.demote, by=c("demote_type", "funding_bin")) %>%
  mutate(funding_bin = factor(funding_bin, 
                           labels=sapply(levels(funding_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.funding.prob.demote <- ggplot(full, aes(x=funding_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Total anti-TIP funding from US (log)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.funding.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.funding.simple.demote <- glm(crim1 ~ log.total.funding1 + fh_cl1 + 
                            new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.funding.int.demote <- glm(crim1 ~ log.total.funding1 + fh_cl1 + 
                         new_watch3 + new_watch2 + new_watch1 + 
                     log.total.funding1 * new_watch3 + 
                     log.total.funding1 * new_watch2 + 
                     log.total.funding1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Total anti-TIP funding from US (log)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.funding.simple.demote, model.funding.int.demote), 
                             calc.pseudo.r.squared)))

stargazer(model.funding.simple.demote, model.funding.int.demote,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.funding.int.demote

covars <- model$model %>%
  select(-log.total.funding1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(log.total.funding1 = seq(0, 16, 0.5),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(log.total.funding1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.funding.int.demote <- ggplot(plot.predict, aes(x=log.total.funding1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Total anti-TIP funding from US (log)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.funding.int.demote
```

# Summary

Different forms of scorecard diplomacy have varying effects on the probability of TIP criminalization in a country when interacted with other explanatory variables. These interactive effects are summarized visually and in prose in the table below.

## Monitoring (presence in the TIP report)

```{r, echo=FALSE, results='asis'}
monitoring <- data_frame(Variable = c("Democracy", 
                                      "NGO engagement",
                                      "Media coverage",
                                      "Foreign aid",
                                      "US trade",
                                      "2000 protocol ratification",
                                      "US engagement (observed Wikileaks cables)",
                                      "TIP NGO count",
                                      "TIP funding"),
                         Descriptive = c("Countries with greater civil liberties are more likely to criminalize in general, but the relative impact of being in the report appears to be higher for countries with worse civil liberties (see [figure](#descriptive)). No countries with bad civil liberties criminalized without being in the report.",
                                         "Countries with more active anti-TIP NGOs are more likely to criminalize in general, and presence in the TIP report appears to increase the probability of criminalization—the likelihood of criminalization in cases where a country is not included in the report is about 5% regardless of NGO engagement, while the probability doubles or triples when a case is in the report (see [figure](#descriptive-1)).",
                                         "Presence in the report appears to increase the probability of criminalization much faster when interacted with media coverage—that is, increased media coverage improves the likelihood of criminalization in general, but in cases where the country is included in the TIP report, that probability improves even more (see [figure](#descriptive-2)).",
                                         "Foreign aid has little apparent effect on the probability of criminalization—cases maintain approximately the same probability as logged foreign aid increases. However, for cases *not* included in the report, the probability of criminalization appears to decrease slightly as aid increases. Presence in the report thus may mitigate any negative effects aid might have (see [figure](#descriptive-3)).",
                                         "In general, trade with the US alone does little to change the probability of criminalization, except in cases with the highest amounts of trade (where trade is 0.5–0.6% of the case's GDP). Presence in the TIP report increases that probability at every level of trade. However, it does not appear that trade and presence in the report interact (see [figure](#descriptive-4)).",
                                         "Ratification of the UN's 2000 anti-TIP protocol appears to improve the probability of criminalization, and scorecard diplomacy increases that probability even more, as presence in the TIP report combined with protocol ratification yields the highest probability of criminalization (see [figure](#descriptive-5))",
                                         "Increased US engagement in TIP issues in a country (as measured by TIP-related State Department cables *observed* in Wikileaks) at first appears to increase the probability of criminalization, but it is difficult to determine if engagement interacts with presence in the TIP report because there are so few cases of countries with observed cables that aren't included in the report (see [figure](#descriptive-6)).",
                                         "The number of anti-TIP NGOs in a country (as measured by our own database of NGOs) descriptively appears to have an interactive effect with the TIP report on the probability of criminalization. In general, cases with more NGOs are more likely to criminalize, and cases where the country is included in the report are even more likely to do so  (see [figure](#descriptive-7)).",
                                         "Descriptively, more funding for anti-TIP endeavors appears to increase the probability of criminalization. However, determining the interaction between scorecard diplomacy and funding is difficult—no cases with substantial funding were not included in the TIP report (see [figure](#descriptive-8))."),
                         Interactions = c(paste0("Statistically, this interactive effect is significant. Having worse democracy reduces the likelihood of criminalization by almost 70% for every increase in the Freedom House score (", parens(model.dem.int.report, "inreport1", "z"), "), but the interaction with the TIP report increases that likelihood more than twofold (", parens(model.dem.int.report, "fh_cl1:inreport1", "z"), "). The effect of this interaction on the predicted probabilities of criminalization is apparent visually (see [figure](#interactions-visualized))."),
                                          paste0("This interactive effect is visible when modeled statistically (see [figure](#interactions-visualized-1), though it is not significant (", parens(model.ngo.int.report, "ngos_ave:inreport1", "z"), "). That said, when looking at the model's predicted probabilities, the probability of criminalization decreases slightly as NGO engagement increases for cases *not* in the report, while the probability increases for cases included in the report."),
                                          paste0("Increased media coverage does appear to increase the probability of criminalization slightly (Model 1: ", parens(model.media.simple.report, "ht_news_country1", "z"), ") but the effect of the interaction of coverage and presence in the report is difficult to determine because no under-covered cases were ever not present in the report. This uncertainty is quite evident in the [figure of predicted probabilities](#interactions-visualized-2)."),
                                          paste0("The statistical model bears out this finding. For every increase in logged foreign aid, the probability of criminalization decreases by 8% (", parens(model.aid.int.report, "logeconasstP_1", "z"), "), but presence in the TIP report has a counteracting significant positive effect (", parens(model.aid.int.report, "logeconasstP_1:inreport1", "z"), "). This is apparent in the [figure of predicted probabilities](#interactions-visualized-3), with the caveat that cases receiving no aid are driving some of this effect."),
                                          paste0("Modeling the relationship confirms this hunch. Increased trade has no significant effect on the likelihood of criminalization (", parens(model.trade.int.report, "newus_tradeshare_gdp", "z"), "), while presence in the report increases that probability by more than 4 times (", parens(model.trade.int.report, "inreport1", "z"), "). The interaction between the two is insignificant (", parens(model.trade.int.report, "newus_tradeshare_gdp:inreport1", "z"), "), both mathematically and visually (see [figure](#interactions-visualized-4))."),
                                          paste0("Statistics confirm this finding, to some extent. Presence in the report increases the probability of criminalization by almost 4 times (", parens(model.rat.int.report, "inreport1", "z"), "), while protocol ratification has a negligible positive effect (", parens(model.rat.int.report, "ratproto2000_1", "z"), "; notably, this effect *is* significant when not interacting with the TIP report). The interaction term is positive, but insignificant (", parens(model.rat.int.report, "inreport1:ratproto2000_1", "z"), ") (see [figure](#interactions-visualized-5))."),
                                          paste0("Statistical models again confirm that presence in the TIP report is a powerful predictor of criminalization (Model 2: ", parens(model.wl.int.report, "inreport1", "z"), "), but there is no relationship between observed US engagement and criminalization (", parens(model.wl.int.report, "prop_tip_wl1:inreport1", "z"), ") or the interaction between engagement and presence in the report. This is confirmed graphically (see [figure](#interactions-visualized-6))."),
                                          paste0("Statistical models again confirm presence in the TIP report is a powerful predictor of criminalization (Model 2: ", parens(model.ngo.new.int.report, "inreport1", "z"), "), but there is no relationship between the number of NGOs and criminalization (", parens(model.ngo.new.int.report, "ht_ngos:inreport1", "z"), ") or the interaction between the number of NGOs and presence in the report. This finding may be driven by the fact that there are so few countries with high numbers of NGOs that aren't included in the report (see the huge confidence intervals for the \"not in report\" predicted probabilities in the [figure](#interactions-visualized-7))."),
                                          paste0("When considering only funding and presence in the report, anti-TIP funding has an insignificant positive effect on the probability of criminalization (Model 1: ", parens(model.funding.simple.report, "log.total.funding1", "z"), "), while presence in the report boost that probability more that four times (Model1: ", parens(model.funding.simple.report, "inreport1", "z"), "). When interacting the two variables, though, the funding effect disappears because of the instability of the interaction term (", parens(model.funding.int.report, "log.total.funding1:inreport1", "z"), ")—the huge confidence intervals in the [figure](#interactions-visualized-8) confirm this. There is no interactive relationship between the funding and presence in the report.")))

pandoc.table(monitoring, style="multiline", split.tables=Inf, justify="lll")
```

## Lower tier ratings

