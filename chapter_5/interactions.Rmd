---
title: "Interactions by treatment"
author: "Andrew Heiss"
date: "November 16, 2015"
output: 
  html_document: 
    css: fixes.css
    highlight: pygments
    number_sections: yes
    theme: flatly
    toc: yes
    includes:
      in_header: scripts.html
---

```{r setup, include=FALSE}
source("clean_data.R")
knitr::opts_chunk$set(echo = TRUE)
library(broom)
library(ggplot2)
library(scales)
library(stargazer)

# Multiplier for standard error areas
std <- qnorm(0.95 / 2 + 0.5)

report.colors <- c("#E97F01", "#014358")
rating.colors <- c("#490A3D", "#EA2E49")
demote.colors <- c("#00A0B0", "#6A4A3C", "#CC333F")

df.correct <- df.correct %>%
  mutate(in.report = ifelse(tier1 == 0, "Not in report", "In report"),
         in.report = factor(in.report, levels=c("Not in report", "In report"),
                            ordered=TRUE),
         lower.rating = ifelse(tier1 %in% c(1, 2), "1 or 2", "Watchlist or 3"),
         lower.rating = factor(lower.rating, levels=c("1 or 2", "Watchlist or 3"), 
                               ordered=TRUE))

df.logit.models <- df.correct %>% 
  filter(lag(adjbicrimlevel) == 0 & year > 2001 & year < 2011)

# Calculate a pseudo R-squared measure using
# 1-\frac{\text{Residual Deviance}}{\text{Null Deviance}}
calc.pseudo.r.squared <- function(x.model) {
  return(round(1 - (x.model$deviance / x.model$null.deviance), 4))
}

clean.labs <- function(x) {
  # Divide into comma-separated parts
  separated <- unlist(strsplit(x, ","))
  
  # Remove anything that's not a digit from each part
  cleaned <- sapply(separated, FUN=function (y) 
    as.numeric(gsub("\\[|\\]|\\(|\\)", "", y)))
  
  # Concatenate remaining digits
  return(paste(cleaned, collapse="-"))
}
```


# Monitoring (presence in the TIP report)

## Democracy × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.democracy.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(in.report, fh_cl1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  filter(crim.yes > 0)

p.dem.prob <- ggplot(prob.crim.democracy.report, 
       aes(x=fh_cl1, y=prob.yes, colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.dem.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.dem.simple <- glm(crim1 ~ fh_cl1 + inreport1 + women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.dem.int <- glm(crim1 ~ fh_cl1 + inreport1 + fh_cl1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.dem.simple, model.dem.int), 
                             calc.pseudo.r.squared)))

stargazer(model.dem.simple, model.dem.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.dem.int

new.data <- model$model %>%
  select(-fh_cl1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(fh_cl1 = seq(1, 7, 0.1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.dem.int <- ggplot(plot.predict, aes(x=fh_cl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b", position="jitter") + 
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.dem.int
```

---

## NGO engagement × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_ave.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ngos_ave, seq(0, 10, 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_ave.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_ave.report, by=c("in.report", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos.prob <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="NGO engagement", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.simple <- glm(crim1 ~ ngos_ave + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.int <- glm(crim1 ~ ngos_ave + fh_cl1 + inreport1 + 
                         ngos_ave * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("NGO engagement",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "NGO engagement × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.simple, model.ngo.int), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.simple, model.ngo.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.int

new.data <- model$model %>%
  select(-ngos_ave) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ngos_ave = seq(0, 10, 0.1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.ngo.int <- ggplot(plot.predict, aes(x=ngos_ave, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="NGO engagement", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.ngo.int
```

---

## Media coverage × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.media.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(news_bin = cut(ht_news_country1, c(seq(0, 500, 50), 2500), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, news_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.media.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), news_bin = levels(.$news_bin))) %>%
  left_join(prob.crim.media.report, by=c("in.report", "news_bin")) %>%
  mutate(news_bin = factor(news_bin, 
                           labels=sapply(levels(news_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.media.prob <- ggplot(full, aes(x=news_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Media coverage", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.media.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.media.super.basic <- glm(crim1 ~ ht_news_country1 + inreport1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.basic <- glm(crim1 ~ ht_news_country1 + inreport1 + 
                          ht_news_country1 * inreport1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.simple <- glm(crim1 ~ ht_news_country1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.int <- glm(crim1 ~ ht_news_country1 + fh_cl1 + inreport1 + 
                         ht_news_country1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))
# bloop <- df.logit.models %>% select(name, year, cowcode, crim1, ht_news_country1, inreport1) %>% mutate(ht_news_country1 * inreport1)
# write_csv(bloop, path="~/Desktop/sample_data.csv", na="")

var.labs <- c("Media coverage",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Media coverage × In TIP report")

extra.lines <- list(c("Year fixed effects", c("Yes", "No", "No", "Yes")),
                    c("Pseudo R-squared",
                      sapply(list(model.media.simple, model.media.super.basic,
                                  model.media.basic, model.media.int), 
                             calc.pseudo.r.squared)))

stargazer(model.media.simple, model.media.super.basic, model.media.basic, model.media.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.media.int

new.data <- model$model %>%
  select(-ht_news_country1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_news_country1 = seq(0, 1000, 1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.media.int <- ggplot(plot.predict, aes(x=ht_news_country1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Media coverage", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.media.int
```

---

## US foreign aid × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.aid.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(aid_bin = cut(logeconasstP_1, seq(0, 25, 5), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, aid_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.aid.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), aid_bin = levels(.$aid_bin))) %>%
  left_join(prob.crim.aid.report, by=c("in.report", "aid_bin")) %>%
  mutate(aid_bin = factor(aid_bin, 
                           labels=sapply(levels(aid_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.aid.prob <- ggplot(full, aes(x=aid_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="US aid (logged)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.aid.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.aid.simple <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.aid.int <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + inreport1 + 
                         logeconasstP_1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("US aid (logged)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US aid × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.aid.simple, model.aid.int), 
                             calc.pseudo.r.squared)))

stargazer(model.aid.simple, model.aid.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.aid.int

new.data <- model$model %>%
  select(-logeconasstP_1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(logeconasstP_1 = seq(0, 23, 0.1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.aid.int <- ggplot(plot.predict, aes(x=logeconasstP_1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="US foreign aid (logged)", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.aid.int
```

---

## US trade × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.trade.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(trade_bin = cut(newus_tradeshare_gdp, seq(0, 1, 0.1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, trade_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.trade.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), trade_bin = levels(.$trade_bin))) %>%
  left_join(prob.crim.trade.report, by=c("in.report", "trade_bin")) %>%
  mutate(trade_bin = factor(trade_bin, 
                           labels=sapply(levels(trade_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.trade.prob <- ggplot(full, aes(x=trade_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Share of US trade (% of GDP)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.trade.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.trade.simple <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.trade.int <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + inreport1 + 
                         newus_tradeshare_gdp * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Share of US trade (% of GDP)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Trade share × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.trade.simple, model.trade.int), 
                             calc.pseudo.r.squared)))

stargazer(model.trade.simple, model.trade.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.trade.int

new.data <- model$model %>%
  select(-newus_tradeshare_gdp) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(newus_tradeshare_gdp = seq(0, 0.6, 0.05), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.trade.int <- ggplot(plot.predict, aes(x=newus_tradeshare_gdp, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Trade with US (percent of GDP)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.trade.int
```

---

## Protocol ratified × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.rat.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(in.report, ratproto2000_1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  mutate(ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

p.rat.prob <- ggplot(prob.crim.rat.report, aes(x=ratproto2000_1, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="2000 TIP protocol ratification", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.rat.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.rat.simple <- glm(crim1 ~ fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.rat.int <- glm(crim1 ~ fh_cl1 + inreport1 + 
                         ratproto2000_1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Protocol ratification × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.rat.simple, model.rat.int), 
                             calc.pseudo.r.squared)))

stargazer(model.rat.simple, model.rat.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.rat.int

new.data <- model$model %>%
  select(-ratproto2000_1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ratproto2000_1 = c(0, 1), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE),
         ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.rat.int <- ggplot(plot.predict, aes(x=ratproto2000_1, y=prob, colour=inreport1)) + 
  geom_pointrange(aes(ymax=prob.upper, ymin=prob.lower), size=.75,
                  position=position_dodge(width=0.25)) + 
  labs(x="2000 TIP protocol ratification", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.rat.int
```

---

## Wikileaks engagement/intensity × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.wl.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(wl_bin = cut(prop_tip_wl1, c(seq(0, 0.2, 0.05), 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, wl_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.wl.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), wl_bin = levels(.$wl_bin))) %>%
  left_join(prob.crim.wl.report, by=c("in.report", "wl_bin")) %>%
  mutate(wl_bin = factor(wl_bin, 
                           labels=sapply(levels(wl_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.wl.prob <- ggplot(full, aes(x=wl_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.wl.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.wl.simple <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.wl.int <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + inreport1 + 
                         prop_tip_wl1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Proportion of TIP-related cables (observed in Wikileaks)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "TIP cables × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.wl.simple, model.wl.int), 
                             calc.pseudo.r.squared)))

stargazer(model.wl.simple, model.wl.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.wl.int

new.data <- model$model %>%
  select(-prop_tip_wl1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(prop_tip_wl1 = seq(0, 1, 0.05), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.wl.int <- ggplot(plot.predict, aes(x=prop_tip_wl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.wl.int
```

---

## TIP NGO count × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_new.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ht_ngos, c(seq(0, 20, 5), 100), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_new.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_new.report, by=c("in.report", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos_new.prob <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Number of anti-TIP NGOs", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos_new.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.new.simple <- glm(crim1 ~ ht_ngos + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.new.int <- glm(crim1 ~ ht_ngos + fh_cl1 + inreport1 + 
                         ht_ngos * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Number of anti-TIP NGOs",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Anti-TIP NGOs × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.new.simple, model.ngo.new.int), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.new.simple, model.ngo.new.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.new.int

new.data <- model$model %>%
  select(-ht_ngos) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_ngos = seq(0, 100, 0.5), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.ngo.new.int <- ggplot(plot.predict, aes(x=ht_ngos, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Number of anti-TIP NGOs", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.ngo.new.int
```

---

## TIP funding from US × presence in TIP report

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.funding.report <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(funding_bin = cut(log.total.funding1, c(0, seq(10, 20, 2.5)), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(in.report, funding_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.funding.report %>% ungroup() %>%
  do(expand.grid(in.report = levels(.$in.report), funding_bin = levels(.$funding_bin))) %>%
  left_join(prob.crim.funding.report, by=c("in.report", "funding_bin")) %>%
  mutate(funding_bin = factor(funding_bin, 
                           labels=sapply(levels(funding_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.funding.prob <- ggplot(full, aes(x=funding_bin, y=prob.yes, 
                                 colour=in.report, size=crim.yes)) + 
  geom_point() +
  labs(x="Total anti-TIP funding from US (log)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=report.colors, name="Presence in report") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.funding.prob
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.funding.simple <- glm(crim1 ~ log.total.funding1 + fh_cl1 + inreport1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.funding.int <- glm(crim1 ~ log.total.funding1 + fh_cl1 + inreport1 + 
                         log.total.funding1 * inreport1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Total anti-TIP funding from US (log)",
              "Worse democracy (Freedom House civil liberties)", "In TIP report", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US funding × In TIP report")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.funding.simple, model.funding.int), 
                             calc.pseudo.r.squared)))

stargazer(model.funding.simple, model.funding.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.funding.int

new.data <- model$model %>%
  select(-log.total.funding1) %>%
  group_by(inreport1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(log.total.funding1 = seq(0, 16, 0.5), 
                         inreport1 = c(0, 1)), by="inreport1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(inreport1 = factor(inreport1, labels=c("Not in report", "In report"),
                            ordered=TRUE))

p.funding.int <- ggplot(plot.predict, aes(x=log.total.funding1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=inreport1), 
              alpha=0.2) + 
  geom_line(aes(colour=inreport1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Total anti-TIP funding from US (log)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=report.colors, name=NULL) + 
  scale_colour_manual(values=report.colors, name=NULL)+
  theme_light()
p.funding.int
```

---

# Lower tier ratings

## Democracy × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.democracy.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(lower.rating, fh_cl1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  filter(crim.yes > 0)

p.dem.prob.rating <- ggplot(prob.crim.democracy.rating, 
       aes(x=fh_cl1, y=prob.yes, colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.dem.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.dem.simple <- glm(crim1 ~ fh_cl1 + low_tier1 + women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.dem.int <- glm(crim1 ~ fh_cl1 + low_tier1 + fh_cl1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.dem.simple, model.dem.int), 
                             calc.pseudo.r.squared)))

stargazer(model.dem.simple, model.dem.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.dem.int

new.data <- model$model %>%
  select(-fh_cl1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(fh_cl1 = seq(1, 7, 0.1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.dem.int.rating <- ggplot(plot.predict, aes(x=fh_cl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b", position="jitter") + 
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.dem.int.rating
```

---

## NGO engagement × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_ave.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ngos_ave, seq(0, 10, 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_ave.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_ave.rating, by=c("lower.rating", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos.prob.rating <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                colour=lower.rating, size=crim.yes)) + 
  geom_point(position=position_dodge(width=0.3)) +
  labs(x="NGO engagement", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.simple <- glm(crim1 ~ ngos_ave + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.int <- glm(crim1 ~ ngos_ave + fh_cl1 + low_tier1 + 
                         ngos_ave * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("NGO engagement",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "NGO engagement × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.simple, model.ngo.int), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.simple, model.ngo.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.int

new.data <- model$model %>%
  select(-ngos_ave) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ngos_ave = seq(0, 10, 0.1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.ngo.int.rating <- ggplot(plot.predict, aes(x=ngos_ave, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="NGO engagement", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.ngo.int.rating
```

---

## Media coverage × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.media.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(news_bin = cut(ht_news_country1, c(seq(0, 500, 50), 2500), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, news_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.media.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), news_bin = levels(.$news_bin))) %>%
  left_join(prob.crim.media.rating, by=c("lower.rating", "news_bin")) %>%
  mutate(news_bin = factor(news_bin, 
                           labels=sapply(levels(news_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.media.prob.rating <- ggplot(full, aes(x=news_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Media coverage", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.media.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.media.simple <- glm(crim1 ~ ht_news_country1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.int <- glm(crim1 ~ ht_news_country1 + fh_cl1 + low_tier1 + 
                         ht_news_country1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Media coverage",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Media coverage × Lowest tier")

extra.lines <- list(c("Year fixed effects", c("Yes", "Yes")),
                    c("Pseudo R-squared",
                      sapply(list(model.media.simple, model.media.int), 
                             calc.pseudo.r.squared)))

stargazer(model.media.simple,  model.media.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.media.int

new.data <- model$model %>%
  select(-ht_news_country1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_news_country1 = seq(0, 1000, 1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.media.int.rating <- ggplot(plot.predict, aes(x=ht_news_country1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Media coverage", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.media.int.rating
```

---

## US foreign aid × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.aid.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(aid_bin = cut(logeconasstP_1, seq(0, 25, 5), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, aid_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.aid.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), aid_bin = levels(.$aid_bin))) %>%
  left_join(prob.crim.aid.rating, by=c("lower.rating", "aid_bin")) %>%
  mutate(aid_bin = factor(aid_bin, 
                           labels=sapply(levels(aid_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.aid.prob.rating <- ggplot(full, aes(x=aid_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="US aid (logged)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.aid.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.aid.simple <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.aid.int <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + low_tier1 + 
                         logeconasstP_1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("US aid (logged)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US aid × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.aid.simple, model.aid.int), 
                             calc.pseudo.r.squared)))

stargazer(model.aid.simple, model.aid.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.aid.int

new.data <- model$model %>%
  select(-logeconasstP_1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(logeconasstP_1 = seq(0, 23, 0.1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.aid.int.rating <- ggplot(plot.predict, aes(x=logeconasstP_1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="US foreign aid (logged)", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.aid.int.rating
```

---

## US trade × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.trade.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(trade_bin = cut(newus_tradeshare_gdp, seq(0, 1, 0.1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, trade_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.trade.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), trade_bin = levels(.$trade_bin))) %>%
  left_join(prob.crim.trade.rating, by=c("lower.rating", "trade_bin")) %>%
  mutate(trade_bin = factor(trade_bin, 
                           labels=sapply(levels(trade_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.trade.prob.rating <- ggplot(full, aes(x=trade_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Share of US trade (% of GDP)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.trade.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.trade.simple <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.trade.int <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 + low_tier1 + 
                         newus_tradeshare_gdp * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Share of US trade (part of GDP)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Trade share × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.trade.simple, model.trade.int), 
                             calc.pseudo.r.squared)))

stargazer(model.trade.simple, model.trade.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.trade.int

new.data <- model$model %>%
  select(-newus_tradeshare_gdp) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(newus_tradeshare_gdp = seq(0, 0.6, 0.05), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.trade.int.rating <- ggplot(plot.predict, aes(x=newus_tradeshare_gdp, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Trade with US (percent of GDP)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.trade.int.rating
```

---

## Protocol ratified × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.rat.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  # Treatment
  group_by(lower.rating, ratproto2000_1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  mutate(ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

p.rat.prob.rating <- ggplot(prob.crim.rat.rating, aes(x=ratproto2000_1, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="2000 TIP protocol ratification", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.rat.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.rat.simple <- glm(crim1 ~ fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.rat.int <- glm(crim1 ~ fh_cl1 + low_tier1 + 
                         ratproto2000_1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Protocol ratification × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.rat.simple, model.rat.int), 
                             calc.pseudo.r.squared)))

stargazer(model.rat.simple, model.rat.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.rat.int

new.data <- model$model %>%
  select(-ratproto2000_1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ratproto2000_1 = c(0, 1), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE),
         ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.rat.int.rating <- ggplot(plot.predict, aes(x=ratproto2000_1, y=prob, colour=low_tier1)) + 
  geom_pointrange(aes(ymax=prob.upper, ymin=prob.lower), size=.75,
                  position=position_dodge(width=0.25)) + 
  labs(x="2000 TIP protocol ratification", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.rat.int.rating
```

---

## Wikileaks engagement/intensity × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.wl.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(wl_bin = cut(prop_tip_wl1, c(seq(0, 0.2, 0.05), 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, wl_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.wl.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), wl_bin = levels(.$wl_bin))) %>%
  left_join(prob.crim.wl.rating, by=c("lower.rating", "wl_bin")) %>%
  mutate(wl_bin = factor(wl_bin, 
                           labels=sapply(levels(wl_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.wl.prob.rating <- ggplot(full, aes(x=wl_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.wl.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.wl.simple <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.wl.int <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + low_tier1 + 
                         prop_tip_wl1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Proportion of TIP-related cables (observed in Wikileaks)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "TIP cables × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.wl.simple, model.wl.int), 
                             calc.pseudo.r.squared)))

stargazer(model.wl.simple, model.wl.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.wl.int

new.data <- model$model %>%
  select(-prop_tip_wl1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(prop_tip_wl1 = seq(0, 1, 0.05), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.wl.int.rating <- ggplot(plot.predict, aes(x=prop_tip_wl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.wl.int.rating
```

---

## TIP NGO count × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_new.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(ngos_bin = cut(ht_ngos, c(seq(0, 20, 5), 100), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_new.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_new.rating, by=c("lower.rating", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos_new.prob.rating <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Number of anti-TIP NGOs", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos_new.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.new.simple <- glm(crim1 ~ ht_ngos + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.new.int <- glm(crim1 ~ ht_ngos + fh_cl1 + low_tier1 + 
                         ht_ngos * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Number of anti-TIP NGOs",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Anti-TIP NGOs × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.new.simple, model.ngo.new.int), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.new.simple, model.ngo.new.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.new.int

new.data <- model$model %>%
  select(-ht_ngos) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(ht_ngos = seq(0, 100, 0.5), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.ngo.new.int.rating <- ggplot(plot.predict, aes(x=ht_ngos, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Number of anti-TIP NGOs", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.ngo.new.int.rating
```

---

## TIP funding from US × lower tier ratings

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.funding.rating <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  mutate(funding_bin = cut(log.total.funding1, c(0, seq(10, 20, 2.5)), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(lower.rating, funding_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.funding.rating %>% ungroup() %>%
  do(expand.grid(lower.rating = levels(.$lower.rating), funding_bin = levels(.$funding_bin))) %>%
  left_join(prob.crim.funding.rating, by=c("lower.rating", "funding_bin")) %>%
  mutate(funding_bin = factor(funding_bin, 
                           labels=sapply(levels(funding_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.funding.prob.rating <- ggplot(full, aes(x=funding_bin, y=prob.yes, 
                                 colour=lower.rating, size=crim.yes)) + 
  geom_point() +
  labs(x="Total anti-TIP funding from US (log)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=rating.colors, name="TIP rating") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.funding.prob.rating
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.funding.simple <- glm(crim1 ~ log.total.funding1 + fh_cl1 + low_tier1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.funding.int <- glm(crim1 ~ log.total.funding1 + fh_cl1 + low_tier1 + 
                         log.total.funding1 * low_tier1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Total anti-TIP funding from US (log)",
              "Worse democracy (Freedom House civil liberties)", "Lowest tier", 
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "US funding × Lowest tier")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.funding.simple, model.funding.int), 
                             calc.pseudo.r.squared)))

stargazer(model.funding.simple, model.funding.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.funding.int

new.data <- model$model %>%
  select(-log.total.funding1) %>%
  group_by(low_tier1) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005)) %>%
  right_join(expand.grid(log.total.funding1 = seq(0, 16, 0.5), 
                         low_tier1 = c(0, 1)), by="low_tier1")

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit)),
         low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted) %>%
  mutate(low_tier1 = factor(low_tier1, labels=c("1 or 2", "Watchlist or 3"),
                            ordered=TRUE))

p.funding.int.rating <- ggplot(plot.predict, aes(x=log.total.funding1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=low_tier1), 
              alpha=0.2) + 
  geom_line(aes(colour=low_tier1), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Total anti-TIP funding from US (log)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=rating.colors, name=NULL) + 
  scale_colour_manual(values=rating.colors, name=NULL)+
  theme_light()
p.funding.int.rating
```

---

# Downgrading

## Democracy × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.democracy.down <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  # Treatment
  group_by(demote_type, fh_cl1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  filter(crim.yes > 0)

p.dem.prob.down <- ggplot(prob.crim.democracy.down, 
       aes(x=fh_cl1, y=prob.yes, colour=demote_type, size=crim.yes)) + 
  geom_point() +
  # geom_line(size=1) + 
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.dem.prob.down
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.dem.simple <- glm(crim1 ~ fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                        women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.dem.int <- glm(crim1 ~ fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     fh_cl1 * new_watch3 + 
                     fh_cl1 * new_watch2 + 
                     fh_cl1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.dem.simple, model.dem.int), 
                             calc.pseudo.r.squared)))

stargazer(model.dem.simple, model.dem.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.dem.int

covars <- model$model %>%
  select(-fh_cl1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(fh_cl1 = seq(1, 7, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(fh_cl1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.dem.int.demote <- ggplot(plot.predict, aes(x=fh_cl1, y=prob)) + 
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b", position="jitter") +
  labs(x="Worse democracy (Freedom House civil liberties)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_x_continuous(breaks=seq(1, 7, 1)) +
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.dem.int.demote
```

---

## NGO engagement × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_ave.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(ngos_bin = cut(ngos_ave, seq(0, 10, 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_ave.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_ave.demote, by=c("demote_type", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos.prob.demote <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                colour=demote_type, size=crim.yes)) + 
  geom_point(position=position_dodge(width=0.3)) +
  labs(x="NGO engagement", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.simple <- glm(crim1 ~ ngos_ave + fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.int <- glm(crim1 ~ ngos_ave + fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     ngos_ave * new_watch3 + 
                     ngos_ave * new_watch2 + 
                     ngos_ave * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("NGO engagement",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.simple, model.ngo.int), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.simple, model.ngo.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.int

covars <- model$model %>%
  select(-ngos_ave, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ngos_ave = seq(0, 10, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ngos_ave ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.ngo.int.demote <- ggplot(plot.predict, aes(x=ngos_ave, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="NGO engagement", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.ngo.int.demote
```

---

## Media coverage × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.media.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(news_bin = cut(ht_news_country1, c(seq(0, 500, 50), 2500), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, news_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.media.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), news_bin = levels(.$news_bin))) %>%
  left_join(prob.crim.media.demote, by=c("demote_type", "news_bin")) %>%
  mutate(news_bin = factor(news_bin, 
                           labels=sapply(levels(news_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.media.prob.demote <- ggplot(full, aes(x=news_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Media coverage", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.media.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.media.simple <- glm(crim1 ~ ht_news_country1 + fh_cl1 + 
                          new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.media.int <- glm(crim1 ~ ht_news_country1 + fh_cl1 + 
                       new_watch3 + new_watch2 + new_watch1 + 
                     ht_news_country1 * new_watch3 + 
                     ht_news_country1 * new_watch2 + 
                     ht_news_country1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Media coverage",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", c("Yes", "Yes")),
                    c("Pseudo R-squared",
                      sapply(list(model.media.simple, model.media.int), 
                             calc.pseudo.r.squared)))

stargazer(model.media.simple,  model.media.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.media.int

covars <- model$model %>%
  select(-ht_news_country1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ht_news_country1 = seq(0, 1000, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ht_news_country1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.media.int.demote <- ggplot(plot.predict, aes(x=ht_news_country1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Media coverage", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.media.int.demote
```

---

## US foreign aid × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.aid.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(aid_bin = cut(logeconasstP_1, seq(0, 25, 5), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, aid_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.aid.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), aid_bin = levels(.$aid_bin))) %>%
  left_join(prob.crim.aid.demote, by=c("demote_type", "aid_bin")) %>%
  mutate(aid_bin = factor(aid_bin, 
                           labels=sapply(levels(aid_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.aid.prob.demote <- ggplot(full, aes(x=aid_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="US aid (logged)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.aid.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.aid.simple <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.aid.int <- glm(crim1 ~ logeconasstP_1 + fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     logeconasstP_1 * new_watch3 + 
                     logeconasstP_1 * new_watch2 + 
                     logeconasstP_1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("US aid (logged)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.aid.simple, model.aid.int), 
                             calc.pseudo.r.squared)))

stargazer(model.aid.simple, model.aid.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.aid.int

covars <- model$model %>%
  select(-logeconasstP_1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(logeconasstP_1 = seq(0, 23, 0.1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(logeconasstP_1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.aid.int.demote <- ggplot(plot.predict, aes(x=logeconasstP_1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="US foreign aid (logged)", y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.aid.int.demote
```

---

## US trade × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.trade.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(trade_bin = cut(newus_tradeshare_gdp, seq(0, 1, 0.1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, trade_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.trade.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), trade_bin = levels(.$trade_bin))) %>%
  left_join(prob.crim.trade.demote, by=c("demote_type", "trade_bin")) %>%
  mutate(trade_bin = factor(trade_bin, 
                           labels=sapply(levels(trade_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.trade.prob.demote <- ggplot(full, aes(x=trade_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Share of US trade (% of GDP)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.trade.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.trade.simple <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 +
                          new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.trade.int <- glm(crim1 ~ newus_tradeshare_gdp + fh_cl1 +
                       new_watch3 + new_watch2 + new_watch1 + 
                     newus_tradeshare_gdp * new_watch3 + 
                     newus_tradeshare_gdp * new_watch2 + 
                     newus_tradeshare_gdp * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Share of US trade (part of GDP)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.trade.simple, model.trade.int), 
                             calc.pseudo.r.squared)))

stargazer(model.trade.simple, model.trade.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.trade.int

covars <- model$model %>%
  select(-newus_tradeshare_gdp, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(newus_tradeshare_gdp = seq(0, 0.6, 0.05),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(newus_tradeshare_gdp ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.trade.int.demote <- ggplot(plot.predict, aes(x=newus_tradeshare_gdp, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Trade with US (percent of GDP)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.trade.int.demote
```

---

## Protocol ratified × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.rat.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  # Treatment
  group_by(demote_type, ratproto2000_1) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total) %>%
  mutate(ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

p.rat.prob.demote <- ggplot(prob.crim.rat.demote, aes(x=ratproto2000_1, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="2000 TIP protocol ratification", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.rat.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.rat.simple <- glm(crim1 ~ fh_cl1 + 
                        new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.rat.int <- glm(crim1 ~ fh_cl1 + 
                     new_watch3 + new_watch2 + new_watch1 + 
                     ratproto2000_1 * new_watch3 + 
                     ratproto2000_1 * new_watch2 + 
                     ratproto2000_1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.rat.simple, model.rat.int), 
                             calc.pseudo.r.squared)))

stargazer(model.rat.simple, model.rat.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.rat.int

covars <- model$model %>%
  select(-ratproto2000_1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ratproto2000_1 = c(0, 1),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ratproto2000_1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")),
         ratproto2000_1 = factor(ratproto2000_1, 
                                 labels=c("Not ratified", "Ratified"), 
                                 ordered=TRUE))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.rat.int.demote <- ggplot(plot.predict, aes(x=ratproto2000_1, 
                                             y=prob, colour=demote_type)) + 
  geom_pointrange(aes(ymax=prob.upper, ymin=prob.lower), size=.75,
                  position=position_dodge(width=0.25)) + 
  labs(x="2000 TIP protocol ratification", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.rat.int.demote
```

---

## Wikileaks engagement/intensity × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.wl.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(wl_bin = cut(prop_tip_wl1, c(seq(0, 0.2, 0.05), 1), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, wl_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.wl.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), wl_bin = levels(.$wl_bin))) %>%
  left_join(prob.crim.wl.demote, by=c("demote_type", "wl_bin")) %>%
  mutate(wl_bin = factor(wl_bin, 
                           labels=sapply(levels(wl_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.wl.prob.demote <- ggplot(full, aes(x=wl_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.wl.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.wl.simple <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + 
                       new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.wl.int <- glm(crim1 ~ prop_tip_wl1 + fh_cl1 + 
                    new_watch3 + new_watch2 + new_watch1 + 
                     prop_tip_wl1 * new_watch3 + 
                     prop_tip_wl1 * new_watch2 + 
                     prop_tip_wl1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Proportion of TIP-related cables (observed in Wikileaks)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.wl.simple, model.wl.int), 
                             calc.pseudo.r.squared)))

stargazer(model.wl.simple, model.wl.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.wl.int

covars <- model$model %>%
  select(-prop_tip_wl1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(prop_tip_wl1 = seq(0, 1, 0.05),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(prop_tip_wl1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.wl.int.demote <- ggplot(plot.predict, aes(x=prop_tip_wl1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Proportion of TIP-related cables (observed in Wikileaks)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.wl.int.demote
```

---

## TIP NGO count × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.ngos_new.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(ngos_bin = cut(ht_ngos, c(seq(0, 20, 5), 100), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, ngos_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.ngos_new.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), ngos_bin = levels(.$ngos_bin))) %>%
  left_join(prob.crim.ngos_new.demote, by=c("demote_type", "ngos_bin")) %>%
  mutate(ngos_bin = factor(ngos_bin, 
                           labels=sapply(levels(ngos_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.ngos_new.prob.demote <- ggplot(full, aes(x=ngos_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Number of anti-TIP NGOs", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.ngos_new.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.ngo.new.simple <- glm(crim1 ~ ht_ngos + fh_cl1 + 
                            new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.ngo.new.int <- glm(crim1 ~ ht_ngos + fh_cl1 + 
                         new_watch3 + new_watch2 + new_watch1 + 
                     ht_ngos * new_watch3 + 
                     ht_ngos * new_watch2 + 
                     ht_ngos * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Number of anti-TIP NGOs",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.ngo.new.simple, model.ngo.new.int), 
                             calc.pseudo.r.squared)))

stargazer(model.ngo.new.simple, model.ngo.new.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.ngo.new.int

covars <- model$model %>%
  select(-ht_ngos, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(ht_ngos = seq(0, 100, 0.5),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(ht_ngos ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.ngo.new.int.demote <- ggplot(plot.predict, aes(x=ht_ngos, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Number of anti-TIP NGOs", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.ngo.new.int.demote
```

---

## TIP funding from US × downgrading

### Descriptive

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
prob.crim.funding.demote <- df.correct %>%
  filter(crim1_minus1 == 0, year > 2000) %>%
  gather(demote_type, demote_value, c(new_watch1, new_watch2, new_watch3)) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years"))) %>%
  filter(demote_value == 1) %>%
  mutate(funding_bin = cut(log.total.funding1, c(0, seq(10, 20, 2.5)), 
                        include.lowest=TRUE, ordered_result=TRUE)) %>%
  # Treatment
  group_by(demote_type, funding_bin) %>%
  summarize(total = n(),
            crim.no = sum(crim1 == 0),
            crim.yes = sum(crim1 == 1),
            prob.yes = crim.yes / total)

# group_by() drops unused levels, so we have to make a full skeleton dataframe
full <- prob.crim.funding.demote %>% ungroup() %>%
  do(expand.grid(demote_type = levels(.$demote_type), funding_bin = levels(.$funding_bin))) %>%
  left_join(prob.crim.funding.demote, by=c("demote_type", "funding_bin")) %>%
  mutate(funding_bin = factor(funding_bin, 
                           labels=sapply(levels(funding_bin), FUN=clean.labs))) %>%
  filter(crim.yes > 0)

p.funding.prob.demote <- ggplot(full, aes(x=funding_bin, y=prob.yes, 
                                 colour=demote_type, size=crim.yes)) + 
  geom_point() +
  labs(x="Total anti-TIP funding from US (log)", 
       y="Actual probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion") +
  guides(size=guide_legend(title="Number of cases\nwhere criminalized", order=1)) +
  theme_light()
p.funding.prob.demote
```

### Interactions (models)

```{r, results='asis', echo=FALSE}
model.funding.simple <- glm(crim1 ~ log.total.funding1 + fh_cl1 + 
                            new_watch3 + new_watch2 + new_watch1 + 
                          women1 + ratproto2000_1 + 
                    corrected_regcrim1_1 + missinfo8_2 + year.factor,# + 
                    # bigaid1 + logpop_1 + loggdppercap_1 + corruption_1,
                  data=df.logit.models,
                  family=binomial(link="logit"))
model.funding.int <- glm(crim1 ~ log.total.funding1 + fh_cl1 + 
                         new_watch3 + new_watch2 + new_watch1 + 
                     log.total.funding1 * new_watch3 + 
                     log.total.funding1 * new_watch2 + 
                     log.total.funding1 * new_watch1 + 
                           women1 + ratproto2000_1 + 
                           corrected_regcrim1_1 + missinfo8_2 + year.factor,
                         data=df.logit.models,
                         family=binomial(link="logit"))

var.labs <- c("Total anti-TIP funding from US (log)",
              "Worse democracy (Freedom House civil liberties)", 
              "First demotion (t−3)", "First demotion (t−2)", 
              "First demotion (t−1)",
              "Share of women in parliament", 
              "2000 TIP protocol ratification", 
              "Regional density of criminalization",
              "Missing info",
              "Worse democracy × First demotion (t−3)", 
              "Worse democracy × First demotion (t−2)", 
              "Worse democracy × First demotion (t−1)")

extra.lines <- list(c("Year fixed effects", rep("Yes", 2)),
                    c("Pseudo R-squared",
                      sapply(list(model.funding.simple, model.funding.int), 
                             calc.pseudo.r.squared)))

stargazer(model.funding.simple, model.funding.int,
          covariate.labels=var.labs, 
          dep.var.labels.include=FALSE,
          dep.var.caption="Criminalization",
          apply.coef=exp, type="html", p.auto=FALSE, omit="year\\.factor",
          keep.stat=c("n", "ll"), 
          notes.align="l", add.lines=extra.lines,
          notes=c("Log odds reported; standard errors in parentheses. All explanatory variables are lagged one period unless otherwise noted."))
```

### Interactions (visualized)

*Note: All covariate values held at their mean or modal values; year held constant at 2005. Rug below indicates actual observed values.*

```{r, echo=FALSE, fig.width=8, fig.height=4, warning=FALSE}
model <- model.funding.int

covars <- model$model %>%
  select(-log.total.funding1, -starts_with("new_watch")) %>%
  summarise_each(funs(mean), -(year.factor)) %>%
  mutate(year.factor = factor(2005),
         id = 1)  # For joining into fully expanded dataframe later

new.combinations <- expand.grid(log.total.funding1 = seq(0, 16, 0.5),
                                new_watch = c("1", "2", "3"))
new.data <- new.combinations %>%
  bind_cols(data.frame(model.matrix(log.total.funding1 ~ new_watch + 0, 
                                    data=new.combinations))) %>%
  mutate(id = 1) %>% left_join(covars, by="id") %>%
  select(-c(id, new_watch))

plot.predict <- augment(model, newdata=new.data) %>%
  mutate(prob = model$family$linkinv(.fitted),
         prob.lower = model$family$linkinv(.fitted - (std * .se.fit)),
         prob.upper = model$family$linkinv(.fitted + (std * .se.fit))) %>%
  gather(demote_type, demote_value, starts_with("new_watch")) %>%
  filter(demote_value == 1) %>%
  mutate(demote_type = factor(demote_type, 
                              labels=c("1 year", "2 years", "3 years")))

plot.data <- augment(model, type.predict="response") %>%
  rename(prob = .fitted)

p.funding.int.demote <- ggplot(plot.predict, aes(x=log.total.funding1, y=prob)) +  
  geom_ribbon(aes(ymax=prob.upper, ymin=prob.lower, fill=demote_type), 
              alpha=0.2) + 
  geom_line(aes(colour=demote_type), size=1) +
  geom_rug(data=plot.data, alpha=0.3, size=0.3, sides="b") + 
  labs(x="Total anti-TIP funding from US (log)", 
       y="Predicted probability of criminalization") + 
  scale_y_continuous(labels=percent) + 
  scale_fill_manual(values=demote.colors, name="Time since\ndemotion") + 
  scale_colour_manual(values=demote.colors, name="Time since\ndemotion")+
  theme_light()
p.funding.int.demote
```
